{"version":3,"sources":["./src/app/pages/metas/metas-routing.module.ts","./src/app/pages/metas/metas.module.ts","./src/app/pages/metas/metas.page.ts","./src/app/pages/metas/metas.page.scss","./src/app/pages/metas/metas.page.html"],"names":[],"mappings":"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","file":"src_app_pages_metas_metas_module_ts-es2015.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { MetasPage } from './metas.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MetasPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MetasPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MetasPageRoutingModule } from './metas-routing.module';\n\nimport { MetasPage } from './metas.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    MetasPageRoutingModule\n  ],\n  declarations: [MetasPage]\n})\nexport class MetasPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { NavController } from '@ionic/angular';\nimport { ComunicacionComponentService } from 'src/app/services/comunicacion-component.service';\nimport { NotificacionesService } from 'src/app/services/notificaciones.service';\nimport { SocketServiceService } from 'src/app/services/socket-service.service';\nimport { SqliteServiceService } from 'src/app/services/sqlite-service.service';\nimport * as moment from 'moment';\n\n@Component({\n  selector: 'app-metas',\n  templateUrl: './metas.page.html',\n  styleUrls: ['./metas.page.scss'],\n})\nexport class MetasPage implements OnInit {\n\n \n\n  \n  listMetas = new Array();\n  userData = null;\n  constructor(public navCtrl: NavController,\n    \n    private _comunic: ComunicacionComponentService,\n    private _sqlite: SqliteServiceService,\n    private _notification: NotificacionesService,\n    private _socket: SocketServiceService) {\n\n      \n     \n    try{\n\n      let userDataJson = localStorage.getItem('userData'); \n      this.userData = JSON.parse(userDataJson);\n      console.log('userDataMetas: ',this.userData);\n\n    }catch(e){\n\n      \n\n    }  \n    this.getMetas();\n    this.updateArray();\n  }\n\n\n  changeDate(fecha){\n    return moment(fecha).format('YYYY-MM-DD HH:mm:ss');\n   }\n \n   ngOnInit() {\n  }\n\n\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad MetasPage');\n  }\n\n\n  getMetas() {\n\n\n    this._notification.getHistorialPromotion().then((metas: any) => {\n\n\n      console.log('capacitasion: ', metas);\n\n      metas.forEach(element => {\n\n        this.listMetas.push(element);\n      });\n\n      // this.evaluaYMarcaComoLeido(metas);\n\n\n      console.log('getHistorialMessageMetas ', metas);\n\n    }, err => {\n      //historial desde sqlite\n\n\n    })\n\n\n\n  }\n\n\n  updateArray() {\n    this._comunic.itemComunicacion.subscribe((notificaciones) => {\n\n      if (notificaciones.name === 'new-notification') {\n        if (notificaciones.item.event === 'promocion') {\n          this.marcarComoLeida(notificaciones.item);\n          this.listMetas.push(notificaciones.item);\n        }\n      }\n    })\n  }\n\n\nasync  evaluaYMarcaComoLeido(metas){\n    let funciones={\n      obtenerPromocionesPorUsuario:()=>{\n        return new Promise(async(resolve,reject)=>{\n            let promociones_user= await this._notification.getPromotionRead(this.userData[0].email);\n\n            resolve(promociones_user);\n        })\n      },\n      obtienePromocionesNoLeidas:(promocionesUsuario, promociones)=>{\n        return new Promise(async(resolve,reject)=>{\n\n\n          let promocionesNoLeidas= new Array();\n          let contador=0;\n          for(let i=0; i<promociones.length;i++){\n              let findPromocion = promocionesUsuario.findIndex((o)=> o.promotion_id == promociones[i].promotion_id)\n\n              if(findPromocion==-1){\n                promocionesNoLeidas.push(promociones[i]);\n              }\n\n              contador = contador+1;\n\n              if(contador==promociones.length){\n                resolve(promocionesNoLeidas);\n              }\n          }\n\n\n\n\n        })\n      },\n      registraPromocionesNoLeidas:(promociones)=>{\n        return new Promise(async(resolve,reject)=>{\n\n          console.log('promociones-no-leidas: ',promociones);\n          let contador =0;\n          for(let i=0;i<promociones.length;i++){\n            let modelMeta = {\n\n\n              promotion_id: promociones[i].promotion_id,\n              id_user: this.userData[0].id,\n              photo: null,\n              date_photo: null,\n              seen: true,\n              date_seen: null,\n              created_at: moment().format('YYYY-MM-DD HH:mm')\n        \n            }\n        \n            let promocion_registrada = await this._notification.postMarcarComoLeidaMeta(modelMeta);\n            contador = contador+1;\n            if(contador==promociones.length){\n              resolve(true);\n            }\n          }\n\n        })\n      }\n    }\n\n\n    let  promociones = await  funciones.obtenerPromocionesPorUsuario();\n    let  promociones_no_leidas = await funciones.obtienePromocionesNoLeidas(promociones,metas);\n    let  registra_promociones_no_leidas = await funciones.registraPromocionesNoLeidas(promociones_no_leidas);\n\n\n\n\n\n\n\n\n\n\n  }\n\n\n\n  marcarComoLeida(meta) {\n      console.log('meta_marca_como_leido: ',meta);\n    let modelMeta = {\n\n\n      promotion_id: meta.promotion_id,\n      id_user: this.userData[0].id,\n      photo: null,\n      date_photo: null,\n      seen: true,\n      date_seen: null,\n      created_at: moment().format('YYYY-MM-DD HH:mm')\n\n    }\n\n    this._notification.postMarcarComoLeidaMeta(modelMeta);\n  }\n\n\n\n}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJtZXRhcy5wYWdlLnNjc3MifQ== */\";","export default \"<!--\\n  Generated template for the MetasPage page.\\n\\n  See http://ionicframework.com/docs/components/#navigation for more info on\\n  Ionic pages and navigation.\\n-->\\n\\n\\n<ion-header no-border>\\n  <ion-toolbar color='violet'>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button auto-hide=\\\"false\\\" ></ion-menu-button>\\n    </ion-buttons>\\n    <ion-title>Metas</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n<ion-content padding>\\n\\n\\n\\n\\n  <ion-list *ngFor=\\\"let promocion of listMetas\\\">\\n\\n      <ion-grid>\\n          <ion-row>\\n        \\n            <ion-col col-12>\\n  \\n              <h4 style=\\\"color:#455A64\\\">\\n                {{promocion?.title}}<br/>\\n  \\n              </h4>\\n              <ion-note>\\n                  {{changeDate(promocion?.created_at)}}<br/>\\n                  {{promocion?.user_created}}\\n                </ion-note>\\n              <p>{{promocion?.message}}</p><br/>\\n  \\n            \\n            </ion-col>\\n    \\n          </ion-row>\\n        </ion-grid>\\n\\n\\n\\n  </ion-list>\\n\\n</ion-content>\";"],"sourceRoot":"webpack:///"}