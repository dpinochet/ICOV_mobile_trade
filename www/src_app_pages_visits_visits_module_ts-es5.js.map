{"version":3,"sources":["webpack:///src/app/pages/visits/visits-routing.module.ts","webpack:///src/app/pages/visits/visits.module.ts","webpack:///src/app/pages/visits/visits.page.ts","webpack:///src/app/pages/visits/visits.page.scss","webpack:///src/app/pages/visits/visits.page.html"],"names":["routes","path","component","VisitsPage","VisitsPageRoutingModule","NgModule","imports","RouterModule","exports","VisitsPageModule","CommonModule","FormsModule","IonicModule","declarations","navCtrl","fb","delivery","auth","base","modalCtrl","loadcrtl","route","date_start","allStores","arrayGrouped","form","group","Validators","obtainTrades","create","message","load","present","date","arraySubsidiaries","getVisitsByUserDay","subscribe","data","dismiss","trade","_err","console","error","refreshToken","oauthCredentials","client_secret","client_id","grant_type","refresh_token","getDataRefreshToken","params","HttpParams","append","obtainToken","log","localStorage","setItem","access_token","callSubmit","img","navigateByUrl","state","NavController","FormBuilder","DeliveryServicesService","UserServicesService","BaseServicesService","ModalController","LoadingController","Router","Component","selector","template"],"mappings":"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","file":"src_app_pages_visits_visits_module_ts-es5.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { VisitsPage } from './visits.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: VisitsPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class VisitsPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { VisitsPageRoutingModule } from './visits-routing.module';\n\nimport { VisitsPage } from './visits.page';\n\n\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    VisitsPageRoutingModule,\n    \n  ],\n  declarations: [VisitsPage]\n})\nexport class VisitsPageModule {}\n","import { HttpParams } from '@angular/common/http';\nimport { Component, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { LoadingController, ModalController, NavController } from '@ionic/angular';\nimport { BaseServicesService } from 'src/app/services/base-services.service';\nimport { DeliveryServicesService } from 'src/app/services/delivery-services.service';\nimport { UserServicesService } from 'src/app/services/user-services.service';\nimport { ImgModalPage } from '../img-modal/img-modal.page';\n\n@Component({\n  selector: 'app-visits',\n  templateUrl: './visits.page.html',\n  styleUrls: ['./visits.page.scss'],\n})\nexport class VisitsPage implements OnInit {\n\n\n  ngOnInit() {\n  }\n\n  public form: FormGroup;\n  public date_start: any = '';\n  private allStores: any = [];\n  public arrayGrouped = [];\n\n  constructor(\n    public navCtrl:     NavController,\n    public fb:          FormBuilder,\n    private delivery:   DeliveryServicesService,\n    private auth:       UserServicesService,\n    private base:       BaseServicesService,\n    public modalCtrl:   ModalController,\n    private loadcrtl:   LoadingController,\n    private route:Router\n\n\n  ) {\n    this.form = fb.group({\n      date_start:   ['', Validators.compose([Validators.required])],\n    })\n    // console.log(this.form);\n  } // End constructor\n\n  callSubmit(){this.obtainTrades()}\n\n  async obtainTrades() {\n    let load = await this.loadcrtl.create({ message: 'Cargando, Espere un Momento...' });\n    load.present()\n    let date = this.date_start\n    let arraySubsidiaries = [];\n    this.arrayGrouped = [];\n\n    this.delivery.getVisitsByUserDay(date).subscribe(\n      data => {\n        load.dismiss()\n        let trade = data\n        this.allStores = data;\n      },\n      _err => {\n        load.dismiss()\n        console.error(_err);\n        if( _err == 'Las credenciales de autenticación no se proveyeron.'){ this.refreshToken()}\n      }\n    )\n  }\n\n  refreshToken(){\n    let oauthCredentials = {\n      //Production\n      client_secret: 'YBZ034UTCGYWG13s2rbPhTfLTpECejK0MLB4ktIgeQdPNAynnPGSDiO6DqxKdQRTEBefZqeJwpW5KGMjLyYSsUfQNu1viOuP82rHUYO56APL5wSGzM3tmB7E4o7eoeQS',\n      client_id:      'JLz7ABbliDYJcbvo1qep1cMw6H0EhBciV355XtHE',\n\n      // Testing\n      //client_secret: 'FR2pnhtfXhJKVfKSKz4uNAC2NGKoVhUvS6liFMsT9lgMku1tQgyocVgV7uNv0AIkugaODdWFM6n32qb70ayX5Xd6lKqiJ7pP4u4pZ9PiPnjaDXqRjHPCjphi0g3i7Cpv',\n      //client_id:      'Wb2rpR9eewlcBObARcnEuTtbHdZHfsUbiCc0SWXh',\n\n      grant_type:     'refresh_token',\n      refresh_token:  this.base.getDataRefreshToken()\n    }\n\n    let params = new HttpParams();\n    params = params.append('grant_type', oauthCredentials.grant_type);\n    params = params.append('client_id', oauthCredentials.client_id);\n    params = params.append('client_secret', oauthCredentials.client_secret);\n    params = params.append('refresh_token', oauthCredentials.refresh_token);\n\n    this.auth.obtainToken(params).subscribe(\n      data => {\n        // console.log('se obtuvo refresh token');\n        console.log(data);\n        localStorage.setItem('token', data.access_token);\n        localStorage.setItem('refresh_token', data.refresh_token);\n\n      }, _err => { console.error('no refresh') },\n      () => { this.callSubmit() }\n    )\n\n  }\n\n  modalPhoto(img){\n   // let imgModal = this.navCtrl.push(ImgModalPage, { img: img });\n   this.route.navigateByUrl('img-modal', { state: img });\n  }\n\n  \n\n\n}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJ2aXNpdHMucGFnZS5zY3NzIn0= */\";","export default \"<ion-header>\\n  <ion-navbar color='primary'>\\n    <button ion-button menuToggle>\\n      <ion-icon name=\\\"menu\\\"></ion-icon>\\n    </button>\\n    <ion-title>Reposiciones</ion-title>\\n  </ion-navbar>\\n</ion-header>\\n\\n<ion-content padding>\\n\\n  <ion-list>\\n    <!-- <form (ngSubmit)=\\\"callSubmit()\\\" [FormGroup]=\\\"form\\\"> -->\\n    <form (ngSubmit)=\\\"callSubmit()\\\" >\\n      <ion-item>\\n        <ion-label>Fecha de reposición</ion-label>\\n        <ion-datetime displayFormat=\\\"DD-MM-YYYY\\\" cancelText=\\\"Cancelar\\\" [(ngModel)]=\\\"date_start\\\"\\n        doneText=\\\"Seleccionar\\\" min=\\\"2018\\\" name=\\\"date_start\\\">\\n        </ion-datetime>\\n      </ion-item>\\n\\n      <div padding-horizontal>\\n        <div class=\\\"form-error\\\">{{form.errors}}</div>\\n        <button ion-button full type=\\\"submit\\\" [disabled]=\\\"date_start == ''\\\">Obtener Reposiciones</button>\\n      </div>\\n\\n    </form>\\n    <br>\\n    <!-- {{ allStores | json }} -->\\n    <div *ngFor=\\\"let item of allStores\\\" >\\n      <div *ngIf=\\\"item.data != undefined\\\" >\\n\\n      <ul *ngIf=\\\"item.data.length > 0\\\" > <b style=\\\"\\\"> {{ item.stores }} ({{ item.data.length }}) </b> </ul>\\n      <div *ngIf=\\\"item.data.length > 0\\\" >\\n\\n        <ion-list>\\n          <ion-item *ngFor=\\\"let subsidiary of item.data\\\">\\n            <ion-thumbnail item-start>\\n              <img src=\\\"{{ subsidiary.data2.photo }}\\\">\\n            </ion-thumbnail>\\n            <h2>{{ subsidiary.subsidiary }}</h2>\\n            <p>{{ subsidiary.data2.date | date:'dd/MM/yyyy HH:mm' }}</p>\\n            <button ion-button clear item-end (click)=\\\"modalPhoto(subsidiary.data2.photo)\\\" > Ver </button>\\n          </ion-item>\\n        </ion-list>\\n      </div>\\n\\n        <!-- <ul *ngFor=\\\"let subsidiary of item.data\\\" >\\n          <ul> {{ subsidiary.subsidiary }} | {{ subsidiary.data2.date | date:'dd/MM/yyyy HH:mm' }} </ul>\\n        </ul> -->\\n      </div>\\n    </div>\\n  </ion-list>\\n\\n\\n\\n</ion-content>\\n\\n\";"]}